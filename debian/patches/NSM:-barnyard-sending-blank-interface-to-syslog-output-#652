Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 securityonion-nsmnow-admin-scripts (20120724-0ubuntu0securityonion157) trusty; urgency=medium
 .
   * NSM: barnyard sending blank interface to syslog output #652
Author: Doug Burks <doug.burks@gmail.com>

---
The information above should follow the Patch Tagging Guidelines, please
checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: <vendor|upstream|other>, <url of original patch>
Bug: <url in upstream bugtracker>
Bug-Debian: http://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: <no|not-needed|url proving that it has been forwarded>
Reviewed-By: <name and email of someone who approved the patch>
Last-Update: <YYYY-MM-DD>

--- securityonion-nsmnow-admin-scripts-20120724.orig/usr/sbin/nsm_sensor_add
+++ securityonion-nsmnow-admin-scripts-20120724/usr/sbin/nsm_sensor_add
@@ -556,6 +556,7 @@ EOF_HTTP_AGENT_EXCLUDE
 THE_TIME=$(date)
 cat >/etc/nsm/$SENSOR_NAME/barnyard2.conf << EOF_BARNYARD2
 # barnyard2.conf: auto-generated by NSMnow Administration on $THE_TIME
+config alert_with_interface_name
 config logdir: $SENSOR_LOG_DIR
 config classification_file: /etc/nsm/$SENSOR_NAME/classification.config
 config reference_file:      /etc/nsm/$SENSOR_NAME/reference.config
--- securityonion-nsmnow-admin-scripts-20120724.orig/usr/sbin/nsm_sensor_ps-restart
+++ securityonion-nsmnow-admin-scripts-20120724/usr/sbin/nsm_sensor_ps-restart
@@ -561,8 +561,13 @@ do
 		touch $BARNYARD2_WALDO
 		chown $SENSOR_USER:$SENSOR_GROUP $BARNYARD2_WALDO
 
+                # add option to barnyard config
+                if ! grep "config alert_with_interface_name" $BARNYARD2_CONFIG >/dev/null 2>&1; then
+                        sed -i '/^# barnyard2.conf: /a config alert_with_interface_name' $BARNYARD2_CONFIG
+                fi
+
 		# start barnyard2
-		[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && $ACTION "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $SENSOR_LOG_DIR -f snort.unified2 -w $BARNYARD2_WALDO -i 1 $BARNYARD2_OPTIONS" "$PROCESS_PID_DIR/$SENSOR/barnyard2.pid" "$PROCESS_LOG_DIR/$SENSOR/barnyard2.log" "barnyard2 (spooler, unified2 format)"
+		[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && $ACTION "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $SENSOR_LOG_DIR -f snort.unified2 -w $BARNYARD2_WALDO -i $SENSOR_NAME $BARNYARD2_OPTIONS" "$PROCESS_PID_DIR/$SENSOR/barnyard2.pid" "$PROCESS_LOG_DIR/$SENSOR/barnyard2.log" "barnyard2 (spooler, unified2 format)"
 	else
 		# we have one instance of barnyard2 per Snort instance
                 for i in `seq 1 $IDS_LB_PROCS`; do
@@ -582,8 +587,13 @@ do
 			touch $WALDO
 			chown $SENSOR_USER:$SENSOR_GROUP $WALDO
 
+	                # add option to barnyard config
+        	        if ! grep "config alert_with_interface_name" $BARNYARD2_CONFIG >/dev/null 2>&1; then
+                	        sed -i '/^# barnyard2.conf: /a config alert_with_interface_name' $BARNYARD2_CONFIG
+	                fi
+
 			# start barnyard2
-			[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && $ACTION "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $UNI_DIR -f snort.unified2 -w $WALDO -i $i $BARNYARD2_OPTIONS" "$PID" "$LOG" "barnyard2-$i (spooler, unified2 format)"
+			[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && $ACTION "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $UNI_DIR -f snort.unified2 -w $WALDO -i $SENSOR_NAME-$i $BARNYARD2_OPTIONS" "$PID" "$LOG" "barnyard2-$i (spooler, unified2 format)"
 		done
 	fi
 
--- securityonion-nsmnow-admin-scripts-20120724.orig/usr/sbin/nsm_sensor_ps-start
+++ securityonion-nsmnow-admin-scripts-20120724/usr/sbin/nsm_sensor_ps-start
@@ -566,8 +566,13 @@ do
 		touch $BARNYARD2_WALDO
 		chown $SENSOR_USER:$SENSOR_GROUP $BARNYARD2_WALDO
 
+                # add option to barnyard config
+                if ! grep "config alert_with_interface_name" $BARNYARD2_CONFIG >/dev/null 2>&1; then
+                        sed -i '/^# barnyard2.conf: /a config alert_with_interface_name' $BARNYARD2_CONFIG
+                fi
+
 		# start barnyard2
-		[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && process_start "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $SENSOR_LOG_DIR -f snort.unified2 -w $BARNYARD2_WALDO -i 1 $BARNYARD2_OPTIONS" "$PROCESS_PID_DIR/$SENSOR/barnyard2.pid" "$PROCESS_LOG_DIR/$SENSOR/barnyard2.log" "barnyard2 (spooler, unified2 format)"
+		[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && process_start "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $SENSOR_LOG_DIR -f snort.unified2 -w $BARNYARD2_WALDO -i $SENSOR_NAME $BARNYARD2_OPTIONS" "$PROCESS_PID_DIR/$SENSOR/barnyard2.pid" "$PROCESS_LOG_DIR/$SENSOR/barnyard2.log" "barnyard2 (spooler, unified2 format)"
 	else
 		# we need one instance of barnyard2 per Snort instance
 		for i in `seq 1 $IDS_LB_PROCS`; do
@@ -587,8 +592,13 @@ do
 			touch $WALDO
 			chown $SENSOR_USER:$SENSOR_GROUP $WALDO
 
+	                # add option to barnyard config
+        	        if ! grep "config alert_with_interface_name" $BARNYARD2_CONFIG >/dev/null 2>&1; then
+                	        sed -i '/^# barnyard2.conf: /a config alert_with_interface_name' $BARNYARD2_CONFIG
+	                fi
+
 			# start barnyard2
-			[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && process_start "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $UNI_DIR -f snort.unified2 -w $WALDO -i $i $BARNYARD2_OPTIONS" "$PID" "$LOG" "barnyard2-$i (spooler, unified2 format)"
+			[ "$BARNYARD2_ENABLED" == "yes" ] && [ -z "$SKIP_BARNYARD2" ] && process_start "barnyard2" "-c $BARNYARD2_CONFIG -u $SENSOR_USER -g $SENSOR_GROUP -d $UNI_DIR -f snort.unified2 -w $WALDO -i $SENSOR_NAME-$i $BARNYARD2_OPTIONS" "$PID" "$LOG" "barnyard2-$i (spooler, unified2 format)"
 		done
 	fi
 
